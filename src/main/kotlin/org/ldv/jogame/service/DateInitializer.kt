package org.ldv.jogame.service

import org.ldv.jogame.model.dao.*
import org.ldv.jogame.model.entity.*
import org.springframework.boot.CommandLineRunner
import org.springframework.security.crypto.password.PasswordEncoder
import org.springframework.stereotype.Component
import java.time.LocalDate
import javax.swing.text.PasswordView

@Component
class DataInitializer(
    private val avisDAO: AvisDAO,
    private val clientDAO: ClientDAO,
    private val commandeDAO: CommandeDAO,
    private val jeuxDAO: JeuxDAO,
    private val lignePanierDAO: LignePanierDAO,
    private val paiementDAO: PaiementDAO,
    private val panierDAO: PanierDAO,
    private val roleDAO: RoleDAO,
    private val plateformeExterneDAO: PlateformeExterneDAO,
    private val utilisateurDAO: UtilisateurDAO,
    private val passwordEncoder: PasswordEncoder
) : CommandLineRunner {

    override fun run(vararg args: String?) {

        // Si la base contient déjà des utilisateurs, on ne fait rien
        if (utilisateurDAO.count() > 0) {
            println("Données déjà présentes, initialisation ignorée.")
            return
        }

        println("Injection des données de test...")

        // === UTILISATEURS ===
        val client1 = Client(
            id = null,
            nom = "Durand",
            prenom = "Pierre",
            email = "durand@example.com",
            motDePasse = "Azerty123"
        )

        val admin = Administrateur(
            idutilisateur = null,
            nom = "Admin",
            prenom = "Jean",
            email = "admin@example.com",
            motDePasse = "admin"
        )

        utilisateurDAO.saveAll(listOf(client1, admin))

        // === JEUX ===
        val jeu1 = Jeux(
            id = null,
            titre = "Sekiro",
            description = "Jeu aventure avec des monstres",
            prix = 59.99f,
            categorie = "Aventure",
            plateformeCompatible = "PC",
            cleActivation = "ABC123XYZ",
            videoGameplay = "videos/sekiro.mp4",
            imageJeu = "images/sekiro.jpg"
        )

        val jeu2 = Jeux(
            id = null,
            titre = "Destiny 2",
            description = "Jeu de guerre online ou solos",
            prix = 40.00f,
            categorie = "Action",
            plateformeCompatible = "PC",
            cleActivation = "DEF456GHI",
            videoGameplay = "videos/destiny2.mp3",
            imageJeu = "images/destiny.jpg"
        )

        val jeu3 = Jeux(
            id = null,
            titre = "Batman",
            description = "Jeu combat avec des super mechants",
            prix = 10.00f,
            categorie = "Action",
            plateformeCompatible = "STEAM",
            cleActivation = "JKL789OPI",
            videoGameplay = "videos/batman.mp3",
            imageJeu = "img/batman.jpg"
        )
        val jeux = listOf(jeu1, jeu2, jeu3)

        jeuxDAO.save(jeu1)
        jeuxDAO.save(jeu2)
        jeuxDAO.save(jeu3)


        // === AVIS ===
        val avis1 = Avis(
            id = null,
            note = 5,
            commentaire = "Excellent jeu !",
            dateAvis = LocalDate.parse("2025-11-17")
        )
        val avis2 = Avis(
            id = null,
            note = 4,
            commentaire = "Très bon gameplay",
            dateAvis = LocalDate.parse("2025-11-18")
        )

        val avis3 = Avis(
            id = null,
            note = 3,
            commentaire = "Pas mal mais quelques bugs",
            dateAvis = LocalDate.parse("2025-11-19")
        )



        avisDAO.save(avis1)
        avisDAO.save(avis2)
        avisDAO.save(avis3)

        //Role//
        val roleAdmin = Role(
            nom = "ADMIN"
        )

        val roleClient = Role(
            nom = "CLIENT"
        )

        roleDAO.saveAll(listOf(roleAdmin, roleClient))


        // === PANIER ===
        val panier = Panier(
            id = null,
            dateCreation = LocalDate.parse("2025-11-17"),
            total = 0f,
            client = client1
        )

        panierDAO.save(panier)

        // === COMMANDE ===
        val commande = Commande(
            id = null,
            dateCommande = LocalDate.parse("2025-11-17"),
            montantTotal = 59.99f,
            statut = "EN_COURS"
        )

        commandeDAO.save(commande)

        println("Données initiales insérées !")
    }
}
